/*
 * GPII Ping Server
 *
 * Copyright 2017 Raising the Floor - International
 *
 * Licensed under the New BSD license. You may not use this file except in
 * compliance with this License.
 * You may obtain a copy of the License at
 * https://github.com/GPII/universal/blob/master/LICENSE.txt
 */

"use strict";

var fluid = require("infusion"),
    gpii = fluid.registerNamespace("gpii");

fluid.defaults("gpii.flowManager.pingServer", {
    gradeNames: ["kettle.app"],
    requestHandlers: {
        ping: {
            route: "/ping",
            method: "get",
            type: "gpii.flowManager.pingServer.handler"
        }
    }
});

fluid.defaults("gpii.flowManager.pingServer.handler", {
    gradeNames: ["kettle.request.http"],
    invokers: {
        handleRequest: {
            funcName: "gpii.flowManager.pingServer.handleRequest",
            args: ["{that}", "{gpii.flowManager}"]
        }
    }
});

gpii.flowManager.pingServer.handleRequest = function (request, flowManager) {
    request.events.onSuccess.fire({
        flowManagerId: flowManager.id,
        serverTime: new Date().toISOString()
    });
};
